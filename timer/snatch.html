<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snatch Timer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background-color: #f5f5f5;
            margin: 20px;
            box-sizing: border-box;
            transition: background-color 0.5s;
        }
        .timer {
            font-size: 30vmin;
            margin-bottom: 20px;
            text-align: center;
        }
        .info {
            display: flex;
            width: 100%;
            justify-content: space-between;
            font-size: 4vmin;
        }
        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        .controls button, .controls select {
            padding: 20px 40px;
            font-size: 4vmin;
            cursor: pointer;
        }
        .interval-text {
            font-size: 8vmin;
            margin: 20px 0;
            text-align: center;
            width: 100%;
        }
        .randomize-btn {
            font-size: 4vmin;
            padding: 20px 40px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="interval-text" id="intervalText">Get ready!</div>
    <div class="timer" id="timer">00:00</div>
    <div class="info">
        <div id="elapsedTime">Elapsed: 00:00</div>
        <div id="currentInterval">Interval: 0/4</div>
        <div id="remainingTime">Remaining: 08:00</div>
    </div>
    <div class="controls">
        <select id="iterationsSelect">
            <option value="2">2 Series</option>
            <option value="3">3 Series</option>
            <option value="4">4 Series</option>
            <option value="5">5 Series</option>
        </select>
        <select id="seriesSelect">
            <option value="5_4">5/4 Series</option>
            <option value="10_2">10/2 Series</option>
            <option value="Alternate">Alternate</option>
        </select>
        <button id="startBtn">Start!</button>
        <button id="resetBtn">Reset</button>
        <button id="randomizeBtn" class="randomize-btn">ðŸŽ²</button>
    </div>

    <audio id="beepSound" preload="auto">
        <source src="beep.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>
    <audio id="beepSound2" preload="auto">
        <source src="beep2.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <script>
        // 5/4 Series - Left Hand only: 4 minutes total
        let exercise_lh_5_4 = [
            { text: "5 Left Hand", prep: 5, exercise: 10, rest: 15 },    // 0-30s
            { text: "5 Left Hand", prep: 5, exercise: 10, rest: 15 },    // 30-60s
            { text: "5 Left Hand", prep: 5, exercise: 10, rest: 15 },    // 60-90s
            { text: "5 Left Hand", prep: 5, exercise: 10, rest: 135 }    // 90-240s (15s + 120s extra)
        ];

        // 5/4 Series - Right Hand only: 4 minutes total
        let exercise_rh_5_4 = [
            { text: "5 Right Hand", prep: 5, exercise: 10, rest: 15 },    // 0-30s
            { text: "5 Right Hand", prep: 5, exercise: 10, rest: 15 },    // 30-60s
            { text: "5 Right Hand", prep: 5, exercise: 10, rest: 15 },    // 60-90s
            { text: "5 Right Hand", prep: 5, exercise: 10, rest: 135 }    // 90-240s (15s + 120s extra)
        ];

        // 10/2 Series - Left Hand only: 4 minutes total
        let exercise_lh_10_2 = [
            { text: "10 Left Hand", prep: 5, exercise: 20, rest: 35 },   // 0-60s
            { text: "10 Left Hand", prep: 5, exercise: 20, rest: 155 }   // 60-240s (35s + 120s extra)
        ];

        // 10/2 Series - Right Hand only: 4 minutes total
        let exercise_rh_10_2 = [
            { text: "10 Right Hand", prep: 5, exercise: 20, rest: 35 },   // 0-60s
            { text: "10 Right Hand", prep: 5, exercise: 20, rest: 155 }   // 60-240s (35s + 120s extra)
        ];

        const default_lh_5_4 = JSON.parse(JSON.stringify(exercise_lh_5_4));
        const default_rh_5_4 = JSON.parse(JSON.stringify(exercise_rh_5_4));
        const default_lh_10_2 = JSON.parse(JSON.stringify(exercise_lh_10_2));
        const default_rh_10_2 = JSON.parse(JSON.stringify(exercise_rh_10_2));

        let exercises = exercise_lh_5_4;
        let currentInterval = 0;
        let phase = 0; // 0 = prep, 1 = exercise, 2 = rest, 3 = finished
        let timeRemaining = 0;
        let totalTimeElapsed = 0;
        let timerInterval = null;
        let iterations = 2;
        let currentIteration = 1;
        let isRunning = false;
        let workoutPlan = []; // Array to hold the planned series
        
        const timerElement = document.getElementById('timer');
        const elapsedTimeElement = document.getElementById('elapsedTime');
        const currentIntervalElement = document.getElementById('currentInterval');
        const remainingTimeElement = document.getElementById('remainingTime');
        const intervalTextElement = document.getElementById('intervalText');
        const startBtn = document.getElementById('startBtn');
        const resetBtn = document.getElementById('resetBtn');
        const iterationsSelect = document.getElementById('iterationsSelect');
        const seriesSelect = document.getElementById('seriesSelect');
        const randomizeBtn = document.getElementById('randomizeBtn');
        const beepSound = document.getElementById('beepSound');
        const beepSound2 = document.getElementById('beepSound2');

        function createWorkoutPlan() {
            workoutPlan = [];
            const seriesChoice = seriesSelect.value;
            
            if (seriesChoice === '5_4') {
                // 5/4 Series: Alternate LH and RH
                for (let i = 1; i <= iterations; i++) {
                    if (i % 2 === 1) {
                        workoutPlan.push(JSON.parse(JSON.stringify(default_lh_5_4)));
                    } else {
                        workoutPlan.push(JSON.parse(JSON.stringify(default_rh_5_4)));
                    }
                }
            } else if (seriesChoice === '10_2') {
                // 10/2 Series: Alternate LH and RH
                for (let i = 1; i <= iterations; i++) {
                    if (i % 2 === 1) {
                        workoutPlan.push(JSON.parse(JSON.stringify(default_lh_10_2)));
                    } else {
                        workoutPlan.push(JSON.parse(JSON.stringify(default_rh_10_2)));
                    }
                }
            } else if (seriesChoice === 'Alternate') {
                // Specific patterns based on number of series
                if (iterations === 2) {
                    // 2 Series: exercise_lh_5_4 + exercise_rh_10_2
                    workoutPlan.push(JSON.parse(JSON.stringify(default_lh_5_4)));
                    workoutPlan.push(JSON.parse(JSON.stringify(default_rh_10_2)));
                } else if (iterations === 3) {
                    // 3 Series: exercise_lh_5_4 + exercise_rh_10_2 + exercise_lh_5_4
                    workoutPlan.push(JSON.parse(JSON.stringify(default_lh_5_4)));
                    workoutPlan.push(JSON.parse(JSON.stringify(default_rh_10_2)));
                    workoutPlan.push(JSON.parse(JSON.stringify(default_lh_5_4)));
                } else if (iterations === 4) {
                    // 4 Series: exercise_lh_5_4 + exercise_rh_5_4 + exercise_lh_10_2 + exercise_rh_5_4
                    workoutPlan.push(JSON.parse(JSON.stringify(default_lh_5_4)));
                    workoutPlan.push(JSON.parse(JSON.stringify(default_rh_5_4)));
                    workoutPlan.push(JSON.parse(JSON.stringify(default_lh_10_2)));
                    workoutPlan.push(JSON.parse(JSON.stringify(default_rh_5_4)));
                } else if (iterations === 5) {
                    // 5 Series: exercise_lh_5_4 + exercise_rh_5_4 + exercise_lh_10_2 + exercise_rh_10_2 + exercise_lh_5_4
                    workoutPlan.push(JSON.parse(JSON.stringify(default_lh_5_4)));
                    workoutPlan.push(JSON.parse(JSON.stringify(default_rh_5_4)));
                    workoutPlan.push(JSON.parse(JSON.stringify(default_lh_10_2)));
                    workoutPlan.push(JSON.parse(JSON.stringify(default_rh_10_2)));
                    workoutPlan.push(JSON.parse(JSON.stringify(default_lh_5_4)));
                }
            }
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function updateElapsedTimeDisplay() {
            const minutes = Math.floor(totalTimeElapsed / 60);
            const seconds = totalTimeElapsed % 60;
            elapsedTimeElement.textContent = `Elapsed: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function updateRemainingTimeDisplay() {
            const selectedIterations = parseInt(iterationsSelect.value, 10);
            const totalWorkoutTime = selectedIterations * 4 * 60; // 4 minutes per series (240 seconds)
            
            if (isRunning) {
                // During workout, show actual remaining time
                const remainingTime = totalWorkoutTime - totalTimeElapsed;
                const minutes = Math.floor(remainingTime / 60);
                const seconds = remainingTime % 60;
                remainingTimeElement.textContent = `Remaining: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            } else {
                // Before workout starts, show total planned workout time
                const minutes = Math.floor(totalWorkoutTime / 60);
                const seconds = totalWorkoutTime % 60;
                remainingTimeElement.textContent = `Remaining: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
        }

        function updateIntervalCounter() {
            currentIntervalElement.textContent = `Interval: ${currentInterval + 1}/${exercises.length}`;
        }

        function changeBackgroundColor() {
            if (phase === 0) {
                document.body.style.backgroundColor = "#ffff00"; // Yellow for prep
            } else if (phase === 1) {
                document.body.style.backgroundColor = "#ff0000"; // Red for exercise
            } else if (phase === 2) {
                document.body.style.backgroundColor = "#00ff00"; // Green for rest
            } else {
                document.body.style.backgroundColor = "#f5f5f5"; // Default
            }
        }

        /*
        function playBeep() {
            // Create a simple beep sound using Web Audio API
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = 800;
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.5);
        }
        */

        function startNextPhase() {
            if (phase === 3) return;

            const exercise = exercises[currentInterval];
            if (phase === 0) {
                // Moving from prep to exercise - play beep sound
                intervalTextElement.textContent = exercise.text;
                timeRemaining = exercise.exercise;
                phase = 1;
                beepSound.play().catch(error => console.log("Audio play error: ", error));
            } else if (phase === 1) {
                // Moving from exercise to rest
                intervalTextElement.textContent = "Rest";
                timeRemaining = exercise.rest;
                phase = 2;
            } else {
                // Moving from rest to next interval
                currentInterval++;
                if (currentInterval < exercises.length) {
                    // Next interval in current series
                    intervalTextElement.textContent = exercises[currentInterval].text;
                    timeRemaining = exercises[currentInterval].prep;
                    phase = 0;
                } else if (currentIteration < iterations) {
                    // Next series
                    currentIteration++;
                    currentInterval = 0;
                    exercises = workoutPlan[currentIteration - 1];
                    intervalTextElement.textContent = exercises[currentInterval].text;
                    timeRemaining = exercises[currentInterval].prep;
                    phase = 0;
                } else {
                    // Workout completed - play completion sound
                    beepSound2.play().catch(error => console.log("Audio play error: ", error));
                    clearInterval(timerInterval);
                    timerInterval = null;
                    phase = 3;
                    intervalTextElement.textContent = "Completed!";
                    timeRemaining = 0;
                    isRunning = false;
                    startBtn.textContent = "Start!";
                    enableControls();
                }
            }
            changeBackgroundColor();
            updateIntervalCounter();
            updateTimerDisplay();
        }

        function randomizeSelections() {
            const diceRoll = Math.floor(Math.random() * 6) + 1; // Roll 1-6
            const seriesOptions = seriesSelect.options;
            
            // Dice logic for iterations
            let iterationValue;
            if (diceRoll === 1) {
                iterationValue = "2"; // 2 series (8 minutes) Left and Right
            } else if (diceRoll === 2 || diceRoll === 3) {
                iterationValue = "3"; // 3 series (12 minutes) Left, Right, Left
            } else if (diceRoll === 4 || diceRoll === 5) {
                iterationValue = "4"; // 4 series (16 minutes) Left, Right, Left, Right
            } else { // diceRoll === 6
                iterationValue = "5"; // 5 series (20 minutes) Left, Right, Left, Right, Left
            }
            
            // Set iterations based on dice roll
            iterationsSelect.value = iterationValue;
            
            // Random series type (5/4, 10/2, or Alternate)
            seriesSelect.selectedIndex = Math.floor(Math.random() * seriesOptions.length);
            
            // Update remaining time display after randomization
            updateRemainingTimeDisplay();
        }

        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                if (timeRemaining > 0) {
                    timeRemaining--;
                    totalTimeElapsed++;
                    updateTimerDisplay();
                    updateElapsedTimeDisplay();
                    updateRemainingTimeDisplay();
                } else {
                    startNextPhase();
                }
            }, 1000);
        }

        function disableControls() {
            iterationsSelect.disabled = true;
            seriesSelect.disabled = true;
            randomizeBtn.disabled = true;
        }

        function enableControls() {
            iterationsSelect.disabled = false;
            seriesSelect.disabled = false;
            randomizeBtn.disabled = false;
        }

        randomizeBtn.addEventListener('click', randomizeSelections);

        // Update remaining time when iterations selection changes
        iterationsSelect.addEventListener('change', updateRemainingTimeDisplay);
        seriesSelect.addEventListener('change', updateRemainingTimeDisplay);

        startBtn.addEventListener('click', () => {
            if (startBtn.textContent === "Start!") {
                iterations = parseInt(iterationsSelect.value, 10);
                currentIteration = 1;
                currentInterval = 0;
                phase = 0;
                totalTimeElapsed = 0;
                createWorkoutPlan();
                exercises = workoutPlan[0];
                timeRemaining = exercises[0].prep;
                intervalTextElement.textContent = exercises[0].text;
                changeBackgroundColor();
                updateTimerDisplay();
                updateElapsedTimeDisplay();
                updateRemainingTimeDisplay();
                updateIntervalCounter();
                startTimer();
                startBtn.textContent = "Pause";
                isRunning = true;
                disableControls();
            } else if (startBtn.textContent === "Pause") {
                clearInterval(timerInterval);
                timerInterval = null;
                startBtn.textContent = "Resume";
                isRunning = false;
            } else {
                startTimer();
                startBtn.textContent = "Pause";
                isRunning = true;
            }
        });

        resetBtn.addEventListener('click', () => {
            clearInterval(timerInterval);
            timerInterval = null;
            currentInterval = 0;
            phase = 0;
            timeRemaining = 0;
            totalTimeElapsed = 0;
            currentIteration = 1;
            isRunning = false;
            startBtn.textContent = "Start!";
            intervalTextElement.textContent = "Get ready!";
            document.body.style.backgroundColor = "#f5f5f5";
            updateTimerDisplay();
            updateElapsedTimeDisplay();
            updateRemainingTimeDisplay();
            currentIntervalElement.textContent = `Interval: 0/${exercise_lh_5_4.length}`;
            enableControls();
        });

        // Initialize display
        iterationsSelect.value = "2";
        updateTimerDisplay();
        updateElapsedTimeDisplay();
        updateRemainingTimeDisplay();
        currentIntervalElement.textContent = `Interval: 0/${exercise_lh_5_4.length}`;
    </script>
</body>
</html>